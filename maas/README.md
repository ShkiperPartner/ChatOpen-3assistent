# MaaS (Memory as a Service) - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è MaaS –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
maas/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ 20250205000000_add_maas_tables.sql   # SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å 7 —Ç–∞–±–ª–∏—Ü–∞–º–∏
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ apply-maas-migration.mjs             # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ apply-migration-simple.mjs           # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
‚îÇ   ‚îî‚îÄ‚îÄ check-exec-function.mjs              # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ exec_sql
‚îú‚îÄ‚îÄ APPLY_MIGRATION.md                        # üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ STEP_4_QUERIES.sql                        # üîç SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è (–®–∞–≥ 4)
‚îî‚îÄ‚îÄ README.md                                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üóÉÔ∏è –¢–∞–±–ª–∏—Ü—ã

### 1. **facts** - –§–∞–∫—Ç—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–•—Ä–∞–Ω–∏—Ç —Ñ–∞–∫—Ç—ã –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `project_id` ‚Üí —Å–≤—è–∑—å —Å projects
- `subject` - —Ç–µ–º–∞ —Ñ–∞–∫—Ç–∞
- `value` (JSONB) - –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∞
- `level` - —É—Ä–æ–≤–µ–Ω—å: fact, insight, pattern, hypothesis
- `source_type` - –æ—Ç–∫—É–¥–∞ –ø–æ–ª—É—á–µ–Ω: user_stated, inferred, observed, derived

### 2. **thread_summaries** - –°–∞–º–º–∞—Ä–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—Ä–∞—Ç–∫–∏–µ –≤—ã–∂–∏–º–∫–∏ –∏–∑ —Ç—Ä–µ–¥–æ–≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `summary_text` - —Ç–µ–∫—Å—Ç —Å–∞–º–º–∞—Ä–∏
- `message_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- `keywords[]` - –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- `topics` (JSONB) - —Ç–µ–º—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

### 3. **decisions** - –†–µ—à–µ–Ω–∏—è –∏–∑ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è, –ø—Ä–∏–Ω—è—Ç—ã–µ –≤ —Ö–æ–¥–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `decision_text` - —Ç–µ–∫—Å—Ç —Ä–µ—à–µ–Ω–∏—è
- `decision_type` - —Ç–∏–ø: action, preference, plan, goal, constraint
- `status` - —Å—Ç–∞—Ç—É—Å: pending, in_progress, completed, cancelled, deferred
- `priority` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: low, medium, high, urgent

### 4. **links** - –°–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
–ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (—Ñ–∞–∫—Ç—ã, —Ä–µ—à–µ–Ω–∏—è, —Å–∞–º–º–∞—Ä–∏).

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `source_type`, `source_id` - –∏—Å—Ö–æ–¥–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `target_type`, `target_id` - —Ü–µ–ª–µ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `link_type` - —Ç–∏–ø —Å–≤—è–∑–∏: related_to, derived_from, supports, contradicts
- `strength` - —Å–∏–ª–∞ —Å–≤—è–∑–∏ (0.0 - 1.0)

### 5. **sources** - –í–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
–•—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `source_type` - —Ç–∏–ø: web, document, api, database, manual
- `source_url` - URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- `credibility_score` - –æ—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ (0.0 - 1.0)

### 6. **maas_metrics** - –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MaaS —Å–∏—Å—Ç–µ–º—ã.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `metric_type` - —Ç–∏–ø –º–µ—Ç—Ä–∏–∫–∏
- `metric_value` - –∑–Ω–∞—á–µ–Ω–∏–µ
- `recorded_at` - –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏

### 7. **snapshot_cache** - –ö–µ—à —Å–Ω–∞–ø—à–æ—Ç–æ–≤
–ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞–º—è—Ç–∏.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `snapshot_type` - —Ç–∏–ø: full, incremental, summary, context
- `snapshot_data` (JSONB) - –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç–∞
- `expires_at` - –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
- `access_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–°–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –≤ **[APPLY_MIGRATION.md](./APPLY_MIGRATION.md)**

–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `migrations/20250205000000_add_maas_tables.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
  AND table_name IN (
    'facts', 'thread_summaries', 'decisions',
    'links', 'sources', 'maas_metrics', 'snapshot_cache'
  );
```

### –®–∞–≥ 3: –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ **[STEP_4_QUERIES.sql](./STEP_4_QUERIES.sql)**

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∞–Ω—ã —Å `projects` —á–µ—Ä–µ–∑ `project_id`:

```
projects (—Å–æ–∑–¥–∞–Ω–Ω–∞—è –≤—Ä—É—á–Ω—É—é)
‚îú‚îÄ‚îÄ facts (project_id ‚Üí projects.id)
‚îú‚îÄ‚îÄ thread_summaries (project_id ‚Üí projects.id)
‚îú‚îÄ‚îÄ decisions (project_id ‚Üí projects.id)
‚îú‚îÄ‚îÄ links (project_id ‚Üí projects.id)
‚îú‚îÄ‚îÄ sources (project_id ‚Üí projects.id)
‚îú‚îÄ‚îÄ maas_metrics (project_id ‚Üí projects.id)
‚îî‚îÄ‚îÄ snapshot_cache (project_id ‚Üí projects.id)
```

## üìä –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### JSONB –ø–æ–ª—è
- `facts.value` - –≥–∏–±–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `snapshot_cache.snapshot_data` - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `metadata` - –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏

### GIN –∏–Ω–¥–µ–∫—Å—ã
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ JSONB –∏ –º–∞—Å—Å–∏–≤–∞—Ö:
```sql
CREATE INDEX idx_facts_value ON facts USING GIN(value);
CREATE INDEX idx_facts_tags ON facts USING GIN(tags);
```

### CHECK Constraints
–û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:
```sql
CHECK (level IN ('fact', 'insight', 'pattern', 'hypothesis'))
CHECK (confidence >= 0 AND confidence <= 1)
```

### Timestamps
–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç:
- `created_at` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≥–¥–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

### Row Level Security (RLS)
–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## üéì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—Ç–∞

```sql
INSERT INTO facts (project_id, session_id, subject, value, level, source_type)
VALUES (
  'your-project-id',
  'session-123',
  'User Preference',
  '{"theme": "dark", "language": "ru"}'::jsonb,
  'fact',
  'user_stated'
);
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏

```sql
INSERT INTO links (project_id, source_type, source_id, target_type, target_id, link_type)
VALUES (
  'your-project-id',
  'fact',
  'fact-id-here',
  'decision',
  'decision-id-here',
  'supports'
);
```

### –ü–æ–∏—Å–∫ –ø–æ JSONB

```sql
-- –ù–∞–π—Ç–∏ —Ñ–∞–∫—Ç—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∫–ª—é—á–æ–º
SELECT * FROM facts
WHERE value ? 'theme';

-- –ù–∞–π—Ç–∏ —Ñ–∞–∫—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
SELECT * FROM facts
WHERE value @> '{"theme": "dark"}'::jsonb;
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[APPLY_MIGRATION.md](./APPLY_MIGRATION.md)** - –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
- **[STEP_4_QUERIES.sql](./STEP_4_QUERIES.sql)** - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **[migrations/20250205000000_add_maas_tables.sql](./migrations/20250205000000_add_maas_tables.sql)** - –ü–æ–ª–Ω—ã–π SQL –∫–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**PostgreSQL –≤–µ—Ä—Å–∏—è:** 15+ (Supabase)
**–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:** uuid-ossp
**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü:** 7
**–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤:** ~35
**RLS:** Enabled –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
2. ‚úÖ –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–®–∞–≥ 4)
3. üî≤ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å n8n workflow
4. üî≤ –°–æ–∑–¥–∞—Ç—å API endpoints
5. üî≤ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Claude Code

## ü§ù –í–∫–ª–∞–¥

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∫–∞–∫ —É—á–µ–±–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è MaaS –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-02-05
**–ê–≤—Ç–æ—Ä:** Claude Code + Student
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Ready for use
